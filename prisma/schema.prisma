generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url       = env("DATABASE_URL")
}

model Family {
  id        String   @id @default(cuid())
  name      String   @unique
  setupComplete Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  events    Event[]
  chores    Chore[]
  recipes   Recipe[]
  members   FamilyMember[]

  @@index([createdAt])
}

model FamilyMember {
  id           String   @id @default(cuid())
  familyId     String
  name         String
  role         String?  @default("member") // member, parent, kid
  workingHours String?  // e.g., "9-5", "8-4", or "Not working"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  family       Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@index([familyId])
}

model Event {
  id                String             @id @default(cuid())
  familyId          String
  type              EventType          @default(EVENT)
  title             String
  description       String?
  startsAt          DateTime
  endsAt            DateTime?
  location          String?
  isRecurring       Boolean            @default(false)
  recurrencePattern RecurrencePattern?
  recurrenceInterval Int?
  recurrenceEndDate DateTime?
  parentEventId     String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  family            Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@index([familyId, startsAt])
  @@index([startsAt])
  @@index([parentEventId])
}

model Chore {
  id                String             @id @default(cuid())
  familyId          String
  choreTemplateId   String?
  title             String
  assignedTo        String
  dueDay            String
  isRecurring       Boolean            @default(false)
  recurrencePattern RecurrencePattern?
  recurrenceInterval Int?
  recurrenceEndDate DateTime?
  frequency         String?            @default("once") // once, daily, weekly, biweekly, monthly
  eligibleMemberIds String?            // JSON array of member IDs
  parentEventId     String?
  completed         Boolean            @default(false)
  completedAt       DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  family            Family             @relation(fields: [familyId], references: [id], onDelete: Cascade)
  choreTemplate     ChoreTemplate?     @relation(fields: [choreTemplateId], references: [id])

  @@index([familyId, dueDay])
  @@index([completed])
  @@index([parentEventId])
  @@index([choreTemplateId])
}

model Recipe {
  id          String   @id @default(cuid())
  familyId    String
  name        String
  ingredients String
  cookDay     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  family      Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@index([familyId, cookDay])
}

model ChoreTemplate {
  id          String   @id @default(cuid())
  name        String
  description String?
  isSystem    Boolean  @default(false)
  familyId    String?  // null for system templates
  chores      Chore[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([name, familyId])
  @@index([isSystem])
  @@index([familyId])
}

enum EventType {
  WORK
  EVENT
}

enum RecurrencePattern {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}
